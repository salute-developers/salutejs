/* eslint-disable @typescript-eslint/no-var-requires */

const { compileFromFile } = require('json-schema-to-typescript');
const { resolve } = require('path');
const { writeFileSync } = require('fs');
const readline = require('readline');

const { stdin: input, stdout: output } = process;
const rl = readline.createInterface({ input, output });

// eslint-disable-next-line no-console
console.log(
    "!!! Please clone or update 'https://.../assistantapischemas.git' before using 'generate-system-message' !!!\n",
);

rl.question('Path to "assistantapischemas" (../../../assistantapischemas): ', (path) => {
    const cwd = resolve(path || '../../../assistantapischemas', 'SystemMessage');

    const pathToSystemMessageJson = resolve(cwd, 'system_message.json');

    compileFromFile(pathToSystemMessageJson, {
        bannerComment:
            '/* eslint-disable no-use-before-define */\n/* tslint:disable */\n/**\n * This file was automatically generated by json-schema-to-typescript.\n * DO NOT MODIFY IT BY HAND. Instead, modify the source JSONSchema file,\n * and run json-schema-to-typescript to regenerate this file.\n*/',
        cwd,
        style: { printWidth: 120, singleQuote: true, tabWidth: 4, trailingComma: 'all' },
    }).then((systemMessageTs) => {
        writeFileSync('./src/lib/types/systemMessageOriginal.ts', systemMessageTs, { encoding: 'utf-8' });

        rl.close();
    });
});
